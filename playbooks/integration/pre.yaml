---
- hosts: all
  roles:
    - run-devstack

  tasks:
    - name: Install requirements for metalsmith
      pip:
        name: -r /opt/stack/metalsmith/requirements.txt
        extra_args: -c /opt/stack/requirements/upper-constraints.txt
      become: true
      vars:
        ansible_python_interpreter: /usr/bin/{{ metalsmith_python | default('python') }}

    - name: Install metalsmith
      pip:
        name: /opt/stack/metalsmith
        editable: true
      become: true
      vars:
        ansible_python_interpreter: /usr/bin/{{ metalsmith_python | default('python') }}
